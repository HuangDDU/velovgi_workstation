# 23_05_23_9_服务器调参测试

## 1. 集群服务器的项目初始化

1. 环境配置

   - VSCode环境配置：https://xdhpc.xidian.edu.cn/info/1076/1341.htm

   - 具体ssh文件配置，注意key文件放在ssh同目录下就可读了

     ```
     Host 10.250.0.240
       HostName 10.250.0.240
       User 21031211625
       PreferredAuthentications publickey
       IdentityFile C:\\Users\\55459\\.ssh\\21031211625.key
     ```

2. Github项目初始化：

   - cluster_server公钥添加：

   - 项目初始化

     ```
     git clone https://github.com/HuangDDU/velovgi_workstation.git
     ```

3. 三台机子上的作用

   - dev（local_pc）：开发脚本，对数据提取随机500个细胞，实现各种功能。
   - test（local_server）：可以直接执行jupyter notebook，方便。但是只有CPU执行速度慢，内存有限对于我的velovgi到2W以上的细胞就内存也不足了。
   - cluster_test（cluter_server）：不能直接执行jupyter notebook（可以在登陆节点上使用jupyter notebook，只能使用CPU）。但是硬件配置好,GPU执行快，内存大。
   
4. 

## 2. dev 功能完善

1. 3D分层可视化
2. 批次抽取分析
3. epoch调参分析
4. 创建并导出velovgi环境，稍后上传到集群上方便使用。
5. 提交

   ```
   git add .
   git commit -m "批次抽取分析，调参分析"
   
   git checkout main
   git pull origin main
   git merge dev_0522
   ```
   


## 3. test的epoch调参分析

1. 测试erythroid_lineage的所有分析。

2. 测试gastrulation的速率估计与3维可视化。

3. 总结出的epoch调参策略：

   - 速率估计时epoch要设置的尽可能地大
   - epoch调参分析时先等分成5个。如果后面的太相近了，就对前面细分

4. 提交

   ```
   git add .
   git commit -m "test的epoch调参分析"
   git push
   ```

   

## 4. cluster_test环境导入与调参分析

1. 环境导入。

   ```
   pip install conda-pack
   conda pack -n velovgi
   # 上传到/home/21031211625/Code/velovgi_workstation/velovgi_workstation/conda
   mkdir /home/21031211625/anaconda3/envs/velovgi
   tar -xzvf velovgi.tar.gz -C /home/21031211625/anaconda3/envs/velovgi
   ```

2. 尝试使用命令行运行ipynb文件，https://blog.csdn.net/tanshiqian/article/details/122507751。

   ```
   jupyter nbconvert --to notebook --execute test.ipynb --output test_output.ipynb
   ```

3. 测试并对比速度，run_erythroid_lineage_1.velovgi速率估计_tesla.sh输出的run_1.velovgi速率估计_tesla.output显示。该Tesla A40显卡跑一个epoch需要1.9s，而实验室服务器需要6s。

4. 提交：

   ```
   git add .
   git commit -m "环境配置"
   
   git checkout main
   git pull origin main
   git merge cluster_test_0524
   ```

   







